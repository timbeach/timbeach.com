<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timothy D Beach</title>
  <link rel="shortcut icon" href="icons8-orthodox-cross-50.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <style>
    :root {
      --background: #0d0d0d;
      --foreground: #00ff9f;
      --highlight: #ff3cac;
      --glow: rgba(0, 255, 159, 0.9);
      --scanline: rgba(255,255,255,0.04);
      --marquee-duration: 15s;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background-color: var(--background);
      color: var(--foreground);
      font-family: 'Share Tech Mono', monospace;
      text-shadow: 0 0 6px var(--glow);
      position: relative; overflow-x: hidden;
    }
    header {
      text-align: center;
      padding: 2rem 1rem 1rem;
      border-bottom: 2px solid var(--highlight);
      animation: glow-pulse 3s infinite ease-in-out;
      position: relative; z-index: 2;
    }
    header h1 {
      font-size: 2.5rem;
      color: var(--highlight);
      margin: 0;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: rgba(20,20,20,0.8);
      border: 1px solid var(--foreground);
      box-shadow: 0 0 25px var(--glow);
      position: relative; z-index: 2;
      min-height: 400px;
    }
    #content {
      transition: opacity 0.2s ease-in-out;
    }
    h2 {
      text-transform: uppercase;
      color: var(--highlight);
      border-left: 5px solid var(--highlight);
      padding-left: 1rem;
      margin-top: 2rem;
      position: relative;
    }
    h2::after {
      content: '';
      display: block;
      height: 1px;
      background: var(--foreground);
      margin-top: 0.5rem;
      box-shadow: 0 0 8px var(--glow);
    }
    p {
      font-size: 1.1rem;
      line-height: 1.6;
      margin: 1rem 0;
    }
    a {
      color: var(--foreground);
      text-decoration: none;
      border-bottom: 1px dotted var(--highlight);
      cursor: pointer;
    }
    a:hover {
      color: var(--highlight);
      text-shadow: 0 0 6px var(--highlight);
    }
    hr {
      border: none;
      height: 1px;
      background: linear-gradient(to right, transparent, var(--highlight), transparent);
      margin: 3rem 0;
      box-shadow: 0 0 6px var(--highlight);
    }
    .cursor {
      display: inline-block;
      width: 10px; height: 1em;
      background-color: var(--foreground);
      animation: blink 1s step-start infinite;
      vertical-align: bottom;
    }
    @keyframes blink { 50% { opacity: 0; } }
    @keyframes glow-pulse {
      0% { text-shadow: 0 0 4px var(--highlight); }
      50% { text-shadow: 0 0 15px var(--highlight); }
      100% { text-shadow: 0 0 4px var(--highlight); }
    }
    .subtext {
      font-size: 0.9rem; color: #888;
      margin-left: 1.5rem; display: block;
    }
    body::before {
      content: '';
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%; pointer-events: none;
      background: repeating-linear-gradient(to bottom, transparent, transparent 2px, var(--scanline) 3px);
      z-index: 1;
    }
    .terminal-overlay {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #000; color: var(--foreground);
      display: flex; align-items: center; justify-content: center;
      z-index: 99; text-align: left;
      font-family: 'Share Tech Mono', monospace;
    }
    .terminal-box {
      padding: 2rem; background: #111;
      border: 2px solid var(--highlight);
      box-shadow: 0 0 15px var(--highlight);
      max-width: 600px; width: 90%;
      font-size: 1.2rem; line-height: 1.5;
      white-space: pre-line;
    }
    .now-playing {
      margin: 3rem auto 1rem;
      padding: 1rem;
      background: #111;
      border: 1px solid var(--highlight);
      box-shadow: 0 0 10px var(--glow);
      max-width: 800px;
      font-size: 1.1rem;
      position: relative;
      overflow: visible;
    }
    .marquee-wrapper { overflow: hidden; white-space: nowrap; }
    .marquee {
      display: inline-block;
      padding-left: 100%;
      animation: marquee var(--marquee-duration) linear infinite;
    }
    .marquee-wrapper:hover .marquee { animation-play-state: paused; }
    @keyframes marquee { 0% { transform: translateX(0);} 100% { transform: translateX(-100%);} }
    .controls { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; }
    .play-btn {
      background: var(--highlight);
      border: none;
      color: var(--background);
      padding: 0.3rem 0.6rem;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 0 6px var(--highlight);
      text-shadow: none;
    }
    .slider {
      flex: 1; height: 8px;
      background: var(--foreground);
      border-radius: 5px;
      outline: none;
      appearance: none;
      box-shadow: 0 0 8px var(--highlight);
    }
    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%; background: var(--highlight);
      cursor: pointer; box-shadow: 0 0 4px var(--highlight);
    }
    .slider::-moz-range-thumb {
      width: 18px; height: 18px;
      border-radius: 50%; background: var(--highlight);
      cursor: pointer;
    }
    .progress-bar {
      width: 100%; height: 4px;
      background: var(--background);
      border: none; margin-top: 0.5rem;
    }
    .progress-bar::-webkit-progress-value { background: var(--highlight); }
    .progress-bar::-moz-progress-bar { background: var(--highlight); }

    /* Terminal Navigation Styles */
    .terminal-nav {
      background: #111;
      border: 1px solid var(--highlight);
      padding: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 0 10px var(--glow);
    }
    .terminal-prompt {
      color: var(--highlight);
      margin-right: 0.5rem;
    }
    .terminal-input {
      background: transparent;
      border: none;
      color: var(--foreground);
      font-family: inherit;
      outline: none;
      flex: 1;
      font-size: 1.1rem;
    }
    .terminal-output {
      background: #0a0a0a;
      border: 1px solid #333;
      padding: 1rem;
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
      font-size: 0.95rem;
      white-space: pre-wrap;
      display: none;
    }
    .terminal-output.show {
      display: block;
    }
    .breadcrumb {
      color: #888;
      margin-bottom: 1rem;
    }
    .file-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .file-item {
      padding: 0.5rem 0;
      cursor: pointer;
      border-left: 3px solid transparent;
      padding-left: 1rem;
      transition: all 0.3s ease;
    }
    .file-item:hover {
      border-left-color: var(--highlight);
      background: rgba(255, 60, 172, 0.1);
      padding-left: 1.5rem;
    }
    .file-item.directory {
      color: #4FC3F7;
    }
    .file-item.article {
      color: var(--foreground);
    }
    .file-item.executable {
      color: #81C784;
    }
    .search-container {
      margin-bottom: 1rem;
    }
    .search-input {
      width: 100%;
      padding: 0.5rem;
      background: #1a1a1a;
      border: 1px solid var(--highlight);
      color: var(--foreground);
      font-family: inherit;
      font-size: 1rem;
      border-radius: 4px;
      outline: none;
    }
    .search-input:focus {
      box-shadow: 0 0 8px var(--highlight);
    }
    .article-title {
      font-weight: bold;
      color: var(--foreground);
    }
    .article-date {
      color: #888;
      font-size: 0.9rem;
      margin-left: 1rem;
    }
    .article-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }
    .article-content h3 {
      color: var(--highlight);
      border-bottom: 1px solid var(--highlight);
      padding-bottom: 0.5rem;
      margin-top: 2rem;
    }
    .article-content code {
      background: #222;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      color: #81C784;
    }
    .article-content pre {
      background: #1a1a1a;
      padding: 1rem;
      border: 1px solid var(--highlight);
      border-radius: 4px;
      overflow-x: auto;
      margin: 1rem 0;
      box-shadow: 0 0 10px rgba(255, 60, 172, 0.3);
    }
    .article-content pre code {
      background: transparent;
      color: var(--foreground);
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.95rem;
      line-height: 1.4;
      white-space: pre;
      display: block;
    }
    .back-btn {
      background: transparent;
      border: 1px solid var(--highlight);
      color: var(--highlight);
      padding: 0.5rem 1rem;
      font-family: inherit;
      cursor: pointer;
      margin-bottom: 2rem;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      background: var(--highlight);
      color: var(--background);
      box-shadow: 0 0 10px var(--highlight);
    }
    .typing-effect {
      overflow: hidden;
      white-space: nowrap;
      animation: typing 2s steps(40, end);
    }
    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1 onclick="navigate('home')" style="cursor: pointer;">Timothy D Beach</h1>
  </header>
  
  <div class="container">
    <div class="terminal-nav">
      <div class="breadcrumb" id="breadcrumb">~/timbeach.com</div>
      <div style="display: flex; align-items: center;">
        <span class="terminal-prompt">tbeach@system:~$</span>
        <input type="text" class="terminal-input" id="terminalInput" placeholder="type 'help' for commands">
      </div>
      <div class="terminal-output" id="terminalOutput"></div>
    </div>
    
    <div id="content">
      <!-- Content will be loaded by JavaScript -->
    </div>
  </div>

  <div id="terminal" class="terminal-overlay" style="display:none;">
    <div class="terminal-box" id="terminal-box"></div>
  </div>

  <div class="now-playing">
    <div class="marquee-wrapper">
      <div class="marquee">&gt; now playing: "Taiko Flourish" ‚Äì Trashh Panda [Orchestral / Rock]</div>
    </div>
    <div class="controls">
      <button id="playBtn" class="play-btn">&gt;</button>
      <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.5" class="slider" />
    </div>
    <progress id="progressBar" class="progress-bar" value="0" max="1"></progress>
    <audio id="bgAudio" src="taiko.mp3" loop muted></audio>
  </div>

  <script>
    // Articles will be loaded from external files
    let articles = {};
    let projects = {};

    // Load articles index and content
    async function loadArticles() {
      try {
        const response = await fetch('articles/articles.json');
        const articlesIndex = await response.json();
        
        // Load each article's metadata
        for (const [filename, metadata] of Object.entries(articlesIndex)) {
          articles[filename] = {
            title: metadata.title,
            date: metadata.date,
            tags: metadata.tags || [],
            filename: filename
          };
        }
      } catch (error) {
        console.log('Could not load articles index, using fallback data');
        // Fallback to built-in articles if files aren't available
        articles = {
          'parsimony.md': {
            title: 'Parsimony and Aegix Linux',
            content: `
# Parsimony and Aegix Linux

**Parsimony** refers to simplicity or frugality in design‚Äîfavoring the fewest necessary components or complexities. In software engineering, it embodies minimalism, efficiency, and clarity, where complexity is deliberately avoided unless justified by necessity.

Aegix Linux exemplifies parsimony by employing a streamlined approach to its architecture and user experience. Built upon Artix Linux and utilizing the lightweight **Runit** init system instead of the more complex systemd, Aegix emphasizes performance, simplicity, and user control. By reducing dependencies, avoiding unnecessary layers, and adhering to straightforward POSIX-compliant scripting, Aegix Linux provides users with a clean, efficient operating environment that embodies the very principle of parsimony.
            `,
            date: '2025-07-29',
            tags: ['linux', 'aegix', 'philosophy']
          }
        };
      }
    }

    // Load article content from markdown file
    async function loadArticleContent(filename) {
      try {
        console.log(`Attempting to load: articles/${filename}`);
        const response = await fetch(`articles/${filename}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const content = await response.text();
        console.log(`Successfully loaded ${filename}, content length: ${content.length}`);
        return content;
      } catch (error) {
        console.log(`Could not load ${filename}, using fallback. Error:`, error);
        // Return fallback content if file loading fails
        return articles[filename]?.content || `# Article Not Found\n\nSorry, the article "${filename}" could not be loaded.`;
      }
    }

    // Projects data (can be converted to files later too)
    projects = {
      'Aegix Linux': {
        title: 'The Aegix Linux Project',
        content: `
# The Aegix Linux Project

A GNU/Linux distribution built with love, purpose, and parsimony.
[aegixlinux.org](https://aegixlinux.org)

## Project Overview

Aegix Linux combines system simplicity with a carefully curated user experience designed for developers, creators, and those who appreciate meaningful technology.

### Key Features
- **Lightweight yet powerful** - Optimized for minimalism
- **Developer-focused** - Pre-configured development environments
- **Human-focused computing** - Technology that serves higher purposes
- **Community-driven** - Built by users, for users, with love

### Technical Stack
- **Base**: Artix with the Runit init system
- **Desktop**: Suckless dwm, dmenu, dwmblocks, st, and more
- **Package Manager**: yay
- **Security**: encrypted by default
- **Theming**: minimalist, with a focus on readability and simplicity

## Philosophy

Technology should be a tool for human flourishing. Every design decision in Aegix reflects this principle.

*Visit [aegixlinux.org](https://aegixlinux.org) to learn more.*
        `,
        date: '2025-01-20'
      },
      'Orthodox Prayer Audio': {
        title: 'O Most Holy Theotokos, Save Us!',
        content: `
# O Most Holy Theotokos - Prayer Audio Platform
[omostholytheotokos.com](https://omostholytheotokos.com)

A web platform providing high-quality Eastern Orthodox prayer recordings, blessed by Holy Cross Monastery in West Virginia.

## Mission

To make authentic Orthodox prayers accessible to the faithful worldwide, combining traditional spirituality with modern technology.

### Features
- **Monastery-blessed content** - All recordings approved by Holy Cross Monastery
- **High-quality audio** - Professional recording equipment and acoustics
- **Responsive design** - Works on all devices

### Technical Implementation
- **Frontend**: Vanilla HTML/CSS/JS for fast loading
- **Audio**: High-bitrate MP3 with progressive loading
- **SSL**: Secure connections for all users

## Spiritual Technology

This project demonstrates how modern web technology can serve ancient spiritual practices. 

*Visit [omostholytheotokos.com](https://omostholytheotokos.com) to experience it.*
        `,
        date: '2025-01-12'
      }
    };

    let currentPath = [];
    let currentView = 'home';

    // Terminal commands
    const commands = {
      help: () => `Available commands:
  ls          - list files in current directory
  cd [dir]    - change directory
  cat [file]  - display file contents
  clear       - clear terminal
  whoami      - display user info
  pwd         - show current path
  tree        - show directory structure
  back        - return to previous view`,
      
      ls: () => {
        if (currentPath.length === 0) {
          return `articles/    projects/`;
        } else if (currentPath[0] === 'articles') {
          return Object.keys(articles).join('    ');
        } else if (currentPath[0] === 'projects') {
          return Object.keys(projects).join('    ');
        }
        return 'Directory not found';
      },
      
      cd: (dir) => {
        if (!dir || dir === '~' || dir === '/') {
          currentPath = [];
          navigate('home');
          return 'Changed to home directory';
        } else if (dir === '..') {
          if (currentPath.length > 0) {
            currentPath.pop();
            navigate(currentPath.length > 0 ? currentPath[0] : 'home');
            return 'Navigated up one directory';
          }
          return 'Already at root directory';
        } else if (dir === 'articles' && currentPath.length === 0) {
          navigate('articles');
          return 'Entered articles directory';
        } else if (dir === 'projects' && currentPath.length === 0) {
          navigate('projects');
          return 'Entered projects directory';
        }
        return `Directory '${dir}' not found`;
      },
      
      cat: (file) => {
        if (currentPath[0] === 'articles' && articles[file]) {
          showArticle(file, articles[file]);
          return `Fetching ${file} from server...`;
        } else if (currentPath[0] === 'projects' && projects[file]) {
          showArticle(file, projects[file]);
          return `Loading ${file}...`;
        }
        return `File '${file}' not found`;
      },
      
      clear: () => {
        document.getElementById('terminalInput').value = '';
        return '';
      },
      
      whoami: () => 'Timothy D Beach - Software Engineer & Digital Monk',
      
      pwd: () => '~/' + currentPath.join('/'),
      
      tree: () => {
        // Sort articles by date for tree display
        const sortedArticles = Object.keys(articles).sort((a, b) => {
          const dateA = new Date(articles[a].date);
          const dateB = new Date(articles[b].date);
          return dateB - dateA;
        });
        
        return `~/timbeach.com
‚îú‚îÄ‚îÄ portals/
‚îÇ   ‚îú‚îÄ‚îÄ aegix-linux*
‚îÇ   ‚îî‚îÄ‚îÄ theotokos-portal*
‚îú‚îÄ‚îÄ articles/
‚îÇ   ${sortedArticles.map(file => `‚îú‚îÄ‚îÄ ${file}`).join('\n‚îÇ   ')}
‚îî‚îÄ‚îÄ projects/
    ‚îú‚îÄ‚îÄ aegix-linux.md
    ‚îî‚îÄ‚îÄ prayer-audio.md`;
      },
      
      back: () => {
        navigate('home');
        return 'Returned to home directory';
      }
    };

    function navigate(section) {
      const content = document.getElementById('content');
      const breadcrumb = document.getElementById('breadcrumb');
      
      if (section === 'home') {
        currentPath = [];
        currentView = 'home';
        breadcrumb.textContent = '~/timbeach.com';
        // Clear URL hash when going home
        isProgrammaticNavigation = true;
        window.location.hash = '';
        setTimeout(() => {
          isProgrammaticNavigation = false;
        }, 100);
        content.innerHTML = `
          <div class="content">
            <h2>Software Engineering</h2>
            <p>20+ years of solving hard problems quietly</p>
          </div>
          <div class="content">
            <hr>
            <h2>System Files</h2>
            <ul class="file-list">
              <li class="file-item directory" onclick="navigate('articles')">üìÅ articles/</li>
              <li class="file-item directory" onclick="navigate('projects')">üìÅ projects/</li>
            </ul>
          </div>
          <div class="content">
            <hr>
            <h2>Portals</h2>
            <ul class="file-list">
              <li class="file-item executable" onclick="launchTerminal('https://aegixlinux.org')">üêß aegix-linux
                <span class="subtext">-&gt; the GNU/Linux distro project I started w/ my soulmate üíï</span>
              </li>
              <li class="file-item executable" onclick="launchTerminal('https://omostholytheotokos.com')">üôè theotokos-portal
                <span class="subtext">-&gt; Orthodox Christian prayer audio w/ a blessing from Holy Cross Monastery in WV</span>
              </li>
            </ul>
          </div>
        `;
      } else if (section === 'articles') {
        currentPath = ['articles'];
        currentView = 'articles';
        breadcrumb.textContent = '~/timbeach.com/articles';
        // Update URL hash for articles section
        isProgrammaticNavigation = true;
        window.location.hash = 'articles';
        setTimeout(() => {
          isProgrammaticNavigation = false;
        }, 100);
        // Sort articles by date (newest first)
        const sortedArticles = Object.keys(articles).sort((a, b) => {
          const dateA = new Date(articles[a].date);
          const dateB = new Date(articles[b].date);
          return dateB - dateA; // Newest first
        });
        
        content.innerHTML = `
          <button class="back-btn" onclick="navigate('home')">‚Üê back</button>
          <h2>Articles</h2>
          <div class="search-container">
            <input type="text" id="articleSearch" placeholder="Search articles..." class="search-input">
          </div>
          <ul class="file-list" id="articleList">
            ${sortedArticles.map(file => 
              `<li class="file-item article" onclick="showArticle('${file}', articles['${file}'])">
                <span class="article-title">${articles[file].title}</span>
                <span class="article-date">${articles[file].date}</span>
              </li>`
            ).join('')}
          </ul>
        `;
        
        // Add search functionality
        const searchInput = document.getElementById('articleSearch');
        const articleList = document.getElementById('articleList');
        
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const listItems = articleList.querySelectorAll('li');
          
          listItems.forEach(item => {
            const title = item.querySelector('.article-title').textContent.toLowerCase();
            const filename = item.onclick.toString().includes('showArticle') ? 
              item.onclick.toString().match(/showArticle\('([^']+)'/)[1].toLowerCase() : '';
            
            if (title.includes(searchTerm) || filename.includes(searchTerm)) {
              item.style.display = 'block';
            } else {
              item.style.display = 'none';
            }
          });
        });
      } else if (section === 'projects') {
        currentPath = ['projects'];
        currentView = 'projects';
        breadcrumb.textContent = '~/timbeach.com/projects';
        // Update URL hash for projects section
        isProgrammaticNavigation = true;
        window.location.hash = 'projects';
        setTimeout(() => {
          isProgrammaticNavigation = false;
        }, 100);
        content.innerHTML = `
          <button class="back-btn" onclick="navigate('home')">‚Üê back</button>
          <h2>Projects</h2>
          <ul class="file-list">
            ${Object.keys(projects).map(file => 
              `<li class="file-item article" onclick="showArticle('${file}', projects['${file}'])">${file}</li>`
            ).join('')}
          </ul>
        `;
      }
    }

    let isShowingArticle = false; // Prevent multiple simultaneous article loads
    
    async function showArticle(filename, article) {
      if (isShowingArticle) return; // Prevent multiple simultaneous loads
      
      const content = document.getElementById('content');
      const breadcrumb = document.getElementById('breadcrumb');
      
      // Determine the section based on where we are
      let section = 'articles';
      if (currentPath.length > 0) {
        section = currentPath[0];
      } else if (currentView === 'projects') {
        section = 'projects';
      }
      
      // Add to path
      if (currentPath.length === 1) {
        currentPath.push(filename);
      }
      
      breadcrumb.textContent = '~/timbeach.com/' + currentPath.join('/');
      
      // Update URL hash for direct linking
      isProgrammaticNavigation = true;
      window.location.hash = `${section}/${filename}`;
      setTimeout(() => {
        isProgrammaticNavigation = false;
      }, 100);
      
      isShowingArticle = true;
      
      // Load content with smooth transition
      try {
        let markdownContent;
        
        if (section === 'projects' && projects[filename]) {
          // Use built-in project content
          markdownContent = projects[filename].content;
        } else {
          // Load the actual markdown content from server
          markdownContent = await loadArticleContent(filename);
        }
        
        // Create the new content
        const newContent = `
          <button class="back-btn" onclick="navigate('${section}')">‚Üê back to ${section}/</button>
          <div class="article-content">
            ${parseMarkdown(markdownContent)}
          </div>
        `;
        
        // Update content smoothly
        content.style.opacity = '0';
        setTimeout(() => {
          content.innerHTML = newContent;
          content.style.opacity = '1';
        }, 150);
        
      } catch (error) {
        const errorContent = `
          <button class="back-btn" onclick="navigate('${section}')">‚Üê back to ${section}/</button>
          <div class="article-content">
            <h2 style="color: var(--highlight);">Connection Failed</h2>
            <p>Could not load article "${filename}". Please check your connection or try again later.</p>
            <pre style="color: #888;">Error: ${error.message}</pre>
          </div>
        `;
        
        content.style.opacity = '0';
        setTimeout(() => {
          content.innerHTML = errorContent;
          content.style.opacity = '1';
        }, 150);
      }
      currentPath.pop(); // Remove filename from path after loading
      isShowingArticle = false; // Reset flag when done
    }

    function parseMarkdown(content) {
      // First handle code blocks to prevent interference with other parsing
      let processedContent = content;
      
      // Temporarily replace code blocks with placeholders to protect them
      const codeBlocks = [];
      let codeBlockIndex = 0;
      
      // Handle code blocks with language specification
      processedContent = processedContent.replace(/```\s*(\w+)\s*\n([\s\S]*?)\n```/g, (match, lang, code) => {
        const placeholder = `__CODE_BLOCK_${codeBlockIndex}__`;
        codeBlocks.push({ placeholder, lang, code });
        codeBlockIndex++;
        return placeholder;
      });
      
      // Handle code blocks without language specification
      processedContent = processedContent.replace(/```\n([\s\S]*?)\n```/g, (match, code) => {
        const placeholder = `__CODE_BLOCK_${codeBlockIndex}__`;
        codeBlocks.push({ placeholder, lang: '', code });
        codeBlockIndex++;
        return placeholder;
      });
      
      // Handle inline code
      processedContent = processedContent.replace(/`([^`]+)`/g, '<code>$1</code>');
      
      // Handle headers (but not inside code blocks since they're now placeholders)
      processedContent = processedContent
        .replace(/^# (.+)$/gm, '<h2>$1</h2>')
        .replace(/^## (.+)$/gm, '<h3>$1</h3>')
        .replace(/^### (.+)$/gm, '<h4>$1</h4>');
      
      // Handle bold and italic
      processedContent = processedContent
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>');
      
      // Handle links
      processedContent = processedContent.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank">$1</a>');
      
      // Handle paragraphs (but not inside pre tags)
      processedContent = processedContent
        .replace(/\n\n/g, '</p><p>')
        .replace(/^(.+)$/gm, '<p>$1</p>');
      
      // Clean up
      processedContent = processedContent
        .replace(/<p><h/g, '<h')
        .replace(/<\/h([1-6])><\/p>/g, '</h$1>')
        .replace(/<p><pre>/g, '<pre>')
        .replace(/<\/pre><\/p>/g, '</pre>');
      
      // Restore code blocks
      codeBlocks.forEach(({ placeholder, lang, code }) => {
        // Trim leading/trailing whitespace but preserve internal formatting
        const trimmedCode = code.replace(/^\n+|\n+$/g, '');
        const codeElement = lang ? `<pre><code class="language-${lang}">${trimmedCode}</code></pre>` : `<pre><code>${trimmedCode}</code></pre>`;
        processedContent = processedContent.replace(placeholder, codeElement);
      });
      
      return processedContent;
    }

    function showLoadingTerminal(message, callback) {
      const terminal = document.getElementById('terminal');
      const box = document.getElementById('terminal-box');
      
      const messages = [
        '> ' + message,
        '> scanning filesystem...',
        '> parsing metadata...',
        '> rendering content...',
        '> blessing output...'
      ];
      
      terminal.style.display = 'flex';
      box.textContent = ''; // Clear any previous content
      let i = 0;
      
      function showNextMessage() {
        if (i < messages.length) {
          if (i === 0) {
            box.textContent = messages[i];
          } else {
            box.textContent += '\n' + messages[i];
          }
          i++;
          setTimeout(showNextMessage, 800); // Slightly slower for smoother effect
        } else {
          setTimeout(() => {
            terminal.style.display = 'none';
            box.textContent = ''; // Clear content when hiding
            callback();
          }, 1000);
        }
      }
      
      showNextMessage();
    }

    // Handle terminal input
    document.getElementById('terminalInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        const input = this.value.trim();
        const [command, ...args] = input.split(' ');
        const output = document.getElementById('terminalOutput');
        
        if (input) {
          // Show the command that was entered
          output.textContent += `tbeach@system:~$ ${input}\n`;
          output.classList.add('show');
          
          if (commands[command]) {
            const result = commands[command](args.join(' '));
            if (result && command !== 'clear') {
              output.textContent += result + '\n\n';
            }
            if (command === 'clear') {
              output.textContent = '';
              output.classList.remove('show');
            }
          } else {
            output.textContent += `Command not found: ${command}. Type 'help' for available commands.\n\n`;
          }
          
          // Scroll to bottom
          output.scrollTop = output.scrollHeight;
        }
        
        this.value = '';
      }
    });

    // Original functions
    function launchTerminal(url) {
      const terminal = document.getElementById('terminal');
      const box = document.getElementById('terminal-box');
      const messages = [
        '> deflecting spiritual malware...',
        '> blessing packets...',
        '> negotiating secure socket handshake...',
        '> tunneling through firewall...',
        '> rewriting bash history...'
      ];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      terminal.style.display = 'flex';
      box.textContent = '> connecting to ' + url + '...';
      setTimeout(() => { box.textContent += '\n> handshaking...'; }, 800);
      setTimeout(() => { box.textContent += '\n' + randomMessage; }, 1600);
      setTimeout(() => { box.textContent += '\n> launching portal...'; }, 2400);
      setTimeout(() => {
        window.open(url, '_blank');
        terminal.style.display = 'none';
      }, 3400);
    }

    // Audio controls
    const audioEl = document.getElementById('bgAudio');
    const slider = document.getElementById('volumeSlider');
    const btn = document.getElementById('playBtn');
    const progress = document.getElementById('progressBar');
    
    if (audioEl) {
      audioEl.volume = slider.value;
      btn.addEventListener('click', () => {
        if (audioEl.paused) { audioEl.play(); btn.textContent = '='; }
        else { audioEl.pause(); btn.textContent = '>'; }
        audioEl.muted = false;
      });
      slider.addEventListener('input', () => {
        if (audioEl.paused) { audioEl.play(); btn.textContent = '='; }
        audioEl.muted = false;
        audioEl.volume = slider.value;
      });
      audioEl.addEventListener('timeupdate', () => {
        if (audioEl.duration) { progress.value = audioEl.currentTime / audioEl.duration; }
      });
    }

    // Load articles on page load
    loadArticles();

    // Initialize home page content
    setTimeout(() => {
      navigate('home');
    }, 100);

    // Handle URL hash routing for direct article links
    let isHandlingHash = false; // Prevent multiple simultaneous hash handling
    
    function handleHashRoute() {
      if (isHandlingHash) return; // Prevent recursive calls
      
      const hash = window.location.hash.slice(1); // Remove the #
      if (hash) {
        isHandlingHash = true;
        const [section, filename] = hash.split('/');
        
        if (section === 'articles' && filename) {
          // Navigate to articles section first
          navigate('articles');
          // Then show the specific article
          setTimeout(() => {
            if (articles[filename]) {
              showArticle(filename, articles[filename]);
            }
            isHandlingHash = false;
          }, 300);
        } else if (section === 'projects' && filename) {
          // Navigate to projects section first
          navigate('projects');
          // Then show the specific project
          setTimeout(() => {
            if (projects[filename]) {
              showArticle(filename, projects[filename]);
            }
            isHandlingHash = false;
          }, 300);
        } else if (section === 'articles' && !filename) {
          // Just navigate to articles section
          navigate('articles');
          isHandlingHash = false;
        } else if (section === 'projects' && !filename) {
          // Just navigate to projects section
          navigate('projects');
          isHandlingHash = false;
        } else {
          isHandlingHash = false;
        }
      } else {
        isHandlingHash = false;
      }
    }

    let isProgrammaticNavigation = false; // Flag to prevent popstate loops
    
    // Handle browser back/forward buttons
    window.addEventListener('popstate', function() {
      if (isProgrammaticNavigation) return; // Skip if we're programmatically updating hash
      
      const hash = window.location.hash.slice(1);
      if (hash) {
        const [section, filename] = hash.split('/');
        
        if (section === 'articles' && filename && articles[filename]) {
          navigate('articles');
          setTimeout(() => {
            showArticle(filename, articles[filename]);
          }, 100);
        } else if (section === 'projects' && filename && projects[filename]) {
          navigate('projects');
          setTimeout(() => {
            showArticle(filename, projects[filename]);
          }, 100);
        } else if (section === 'articles') {
          navigate('articles');
        } else if (section === 'projects') {
          navigate('projects');
        }
      } else {
        // Going back to home
        navigate('home');
      }
    });

    // Simple hash routing for initial page loads only
    if (window.location.hash) {
      const hash = window.location.hash.slice(1);
      const [section, filename] = hash.split('/');
      
      if (section === 'articles' && filename && articles[filename]) {
        // Navigate to articles and show the specific article
        setTimeout(() => {
          navigate('articles');
          setTimeout(() => {
            showArticle(filename, articles[filename]);
          }, 100);
        }, 100);
      } else if (section === 'projects' && filename && projects[filename]) {
        // Navigate to projects and show the specific project
        setTimeout(() => {
          navigate('projects');
          setTimeout(() => {
            showArticle(filename, projects[filename]);
          }, 100);
        }, 100);
      }
    }

    // Focus terminal input on page load
    document.getElementById('terminalInput').focus();
  </script>
</body>
</html>